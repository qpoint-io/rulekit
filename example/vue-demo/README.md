# Rulekit Vue Demo ğŸ®

An interactive demo of the rulekit expression engine, powered by WebAssembly.

## Features

- âœ… **WASM-powered** - Uses the Go rulekit parser and evaluator compiled to WebAssembly
- âœ… **Real-time parsing** - Auto-parses rules as you type
- âœ… **Live evaluation** - Instantly evaluates rules against test data
- âœ… **AST visualization** - See the abstract syntax tree generated by the parser
- âœ… **Syntax highlighting** - Custom CodeMirror language support for rulekit syntax
- âœ… **Retro UI** - Fun pixel-art aesthetic with animated character
- âœ… **Local storage** - Saves your rules and test data between sessions

## Quick Start

### 1. Build the WASM module

From the rulekit root directory:

```bash
make wasm
```

This compiles the Go package to WebAssembly and copies the files to `public/`.

### 2. Install dependencies

```bash
npm install
```

### 3. Run the dev server

```bash
npm run dev
```

Visit http://localhost:5173 to see the demo!

## How It Works

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vue.js Frontend                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  App.vue                                  â”‚  â”‚
â”‚  â”‚  - Rule input (CodeMirror)                â”‚  â”‚
â”‚  â”‚  - Test data input (JSON)                 â”‚  â”‚
â”‚  â”‚  - Result display                         â”‚  â”‚
â”‚  â”‚  - AST visualization                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                          â”‚
â”‚                      â”‚ import                   â”‚
â”‚                      â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  rulekit-wasm.ts (TypeScript Wrapper)    â”‚  â”‚
â”‚  â”‚  - parse(rule) â†’ { handle, ast }         â”‚  â”‚
â”‚  â”‚  - eval(handle, context) â†’ result        â”‚  â”‚
â”‚  â”‚  - free(handle)                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                          â”‚
â”‚                      â”‚ WebAssembly              â”‚
â”‚                      â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  rulekit.wasm (Go â†’ WASM)                â”‚  â”‚
â”‚  â”‚  - Parse() - lexer, parser, AST          â”‚  â”‚
â”‚  â”‚  - Eval() - rule evaluation               â”‚  â”‚
â”‚  â”‚  - Full stdlib functions                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workflow

1. **User types a rule** â†’ Debounced parse after 80ms
2. **WASM parses rule** â†’ Returns handle + AST as JSON
3. **AST displayed** â†’ Shows the parsed structure
4. **User edits test data** â†’ Debounced eval after 500ms
5. **WASM evaluates rule** â†’ Uses stored handle + test data
6. **Result displayed** â†’ Shows PASS/FAIL + value

### Memory Management

The app properly manages WASM memory:

- Stores the current rule handle in `currentRuleHandle`
- Frees old handle before parsing a new rule
- Frees handle on component unmount
- No memory leaks! ğŸ‰

## Example Rules

Try these in the demo:

```
# Simple equality
domain == "example.com"

# Regex matching
path matches /^\/api\/v\d+/

# Number comparison
status >= 200 && status < 300

# Array membership
method in ["GET", "POST", "PUT"]

# Complex nested logic
(port == 443 || port == 8080) && domain contains "api"

# IP address matching
src.ip == 192.168.0.0/16

# Comments are supported!
tags contains "production" -- check for prod tag
```

## Custom Syntax Highlighting

The demo includes custom CodeMirror syntax highlighting for rulekit rules.

See `src/ruleLanguage.ts` for the language definition.

**Highlighted tokens:**

- Keywords: `in`, `contains`, `matches`, `and`, `or`, `not`
- Operators: `==`, `!=`, `>`, `>=`, `<`, `<=`, `=~`
- Literals: strings, numbers, booleans, IPs, CIDRs, regexes, hex strings
- Comments: `--` line comments, `/* */` block comments
- Fields: `domain`, `src.port`, etc.

## Development

### Project Structure

```
vue-demo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.vue            # Main application
â”‚   â”œâ”€â”€ rulekit-wasm.ts    # WASM wrapper
â”‚   â”œâ”€â”€ rulekit-example.ts # Usage examples
â”‚   â”œâ”€â”€ ruleLanguage.ts    # Syntax highlighting
â”‚   â”œâ”€â”€ main.ts            # Vue entry point
â”‚   â””â”€â”€ style.css          # Retro pixel-art styles
â”‚
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ rulekit.wasm       # Built WASM (gitignored)
â”‚   â”œâ”€â”€ wasm_exec.js       # Go WASM runtime (gitignored)
â”‚   â”œâ”€â”€ test-wasm.html     # Standalone test page
â”‚   â””â”€â”€ *.gif              # Animated character sprites
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

### Building

The WASM files are built from the rulekit root:

```bash
cd ../..  # Go to rulekit root
make wasm
```

This runs:

1. `GOOS=js GOARCH=wasm go build` â†’ Compiles to WASM
2. Copies `wasm_exec.js` from Go installation
3. Places both files in `example/vue-demo/public/`

### Hot Reload

Vite automatically reloads when you edit `.vue`, `.ts`, `.css` files.

For WASM changes:

1. Rebuild: `make wasm` (from rulekit root)
2. Hard refresh: Cmd+Shift+R (browsers cache WASM aggressively)

### Testing

**Browser test page:**
Visit http://localhost:5173/test-wasm.html for a standalone test suite.

**Console examples:**

```javascript
import { runExamples } from "./rulekit-example";
await runExamples();
```

## Retro Easter Egg ğŸ®

The animated character at the top is interactive:

- **Hover over it** with the custom ball cursor to make it hold the ball
- **Watch it walk** back and forth automatically
- It's rendered using pixel-art GIFs with authentic 8fps animation!

## Performance

| Metric      | Value                        |
| ----------- | ---------------------------- |
| WASM Bundle | 4.4 MB (includes Go runtime) |
| Init Time   | 100-200ms (one-time)         |
| Parse Time  | <1ms per rule                |
| Eval Time   | <1ms per evaluation          |

The WASM module loads once on page load and provides instant parsing/evaluation after initialization.

## Browser Support

Requires WebAssembly support:

- âœ… Chrome 57+
- âœ… Firefox 52+
- âœ… Safari 11+
- âœ… Edge 16+

## Troubleshooting

### "WASM module not ready"

Wait a moment - it takes 100-200ms to initialize on first load.

### WASM files missing

Run `make wasm` from the rulekit root directory.

### Parse errors

Check the error message - it shows the exact line and column of the syntax error, plus a helpful suggestion.

### Blank AST

The AST only appears after successfully parsing a rule. Check for parse errors above.

## Learn More

- [WASM Implementation Docs](../../WASM.md) - Full WASM architecture
- [Rulekit README](../../README.md) - Rule syntax and operators
- [cmd/wasm/README.md](../../cmd/wasm/README.md) - WASM build details

## License

Same as the rulekit project.
